id: dmarc-detect

info:
  name: DMARC Detection
  author: brenocss
  severity: info
  metadata:
    verified: true
  tags: dns,dmarc

stop-at-first-match: true
dns:
  - name: _dmarc.{{FQDN}}
    type: TXT
    class: inet
    recursion: true
    retries: 3

    matchers:
      - type: word
        words:
          - "v=dmarc1"
          - "v=DMARC1"

    extractors:
      - type: regex
        group: 1
        regex:
          - "IN\tTXT\t(.+)"

  - name: _dmarc.{{RDN}}
    type: TXT
    class: inet
    recursion: true
    retries: 3
    matchers:
      - type: word
        words:
          - "v=dmarc1"
          - "v=DMARC1"

    extractors:
      - type: regex
        group: 1
        regex:
          - "IN\tTXT\t(.+)"
